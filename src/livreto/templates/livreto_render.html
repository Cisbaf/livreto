{% extends 'base.html' %}
{% load static %}

{% block head %}
    <script src="{% static 'js/jquery-3.3.1.slim.min.js' %}"></script>
    <script src="{% static 'turnjs4/lib/turn.js' %}"></script>
    <style>
        body {
            background: black;
        }
        #flipbook .hard {
            background-color: #ccc; /* Cor de fundo das capas */
            border: 2px solid #333; /* Borda mais grossa */
            text-align: center;
            line-height: 200px; /* Centraliza o texto verticalmente */
            font-weight: bold;
        }
        #flipbook .page {
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        #flipbook img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .box {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden; /* Para evitar que o conteúdo saia do contêiner ao dar zoom */
        }
        .secondBox {
            width: 100vh;
            height: 80vh;
        }
        #flipbook {
            transition: transform 1s ease; /* Transição suave durante o zoom */
            transform-origin: center; /* Alinha a transformação no centro por padrão */
        }
    </style>
{% endblock %}

{% block body %}
    <div class="box">
        <div class="secondBox">
            <div id="flipbook">
                {% for page in pages %}
                    {% if forloop.counter == 1 %}
                        <div class="hard"><img src="{% url 'livreto_render_page' livreto.slug page %}"/></div>
                        <div class="hard"></div>
                    {% else %}
                        <div class="page"><img src="{% url 'livreto_render_page' livreto.slug page %}"/></div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            let zoomLevel = 1;

            // Inicia o flipbook
            $("#flipbook").turn({
                width: "100%",
                height: "100%",
                autoCenter: true
            });

            // Aumentar ou diminuir o zoom ao clicar no flipbook
            $("#flipbook").click(function(event) {
                const offset = $(this).offset(); // Obtém a posição do flipbook na página
                const x = event.pageX - offset.left; // Posição X do clique relativo ao flipbook
                const y = event.pageY - offset.top; // Posição Y do clique relativo ao flipbook

                // Define a origem da transformação para a posição do clique
                $("#flipbook").css({
                    'transform-origin': `${x}px ${y}px`
                });

                // Aumenta ou diminui o zoom
                if (zoomLevel === 1) {
                    zoomLevel += 0.5; // Aumenta o nível de zoom
                } else {
                    zoomLevel = 1; // Retorna ao nível original
                    // Reseta o transform-origin para o centro ao voltar ao zoom original
                    $("#flipbook").css('transform-origin', 'center');
                }
                $("#flipbook").css("transform", "scale(" + zoomLevel + ")");
            });
        });
    </script>
{% endblock %}
